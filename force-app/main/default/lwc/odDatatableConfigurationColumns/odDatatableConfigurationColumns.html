<template>
  <c-od-datatable-popup
    onclose={handleClose}
    container-classes="xl"
    show-spinner={isLoading}
    show-error={errorMessage}
    backdrop-classes="modalBackdropsPropertyEditor"
    spinner-message={loadingMessage}
  >
    <div slot="title" class="title-popup">Configure Columns</div>
    <div slot="body" class={bodyClasses}>
      <span class="slds-align_absolute-center slds-p-bottom--x-small">
        Select the columns you want to add to the table and configure each one
      </span>
      <c-od-datatable-input-generic
        field-name="fields"
        type={theType}
        editable
        value={selectedFields}
        options={fields}
        placeholder="Search field..."
        onupdatefield={handleSelectField}
        opened={isSelectFieldsOpened}
        onfocusdropdown={handleOnFocusDropdown}
        onblurdropdown={handleOnBlurDropdown}
        is-multi
        required
        auto-focus
      >
      </c-od-datatable-input-generic>
      <template if:true={fieldsToDisplayTable.length}>
        <div class="slds-m-top--medium slds-p-around--xx-small">
          <table class="columnsTable">
            <thead>
              <tr>
                <th class="slds-p-around--x-small" style="width: 250px">Field API Name</th>
                <th class="slds-p-around--x-small" style="width: 250px">Label</th>
                <th class="slds-p-around--x-small" style="width: 250px">Type</th>
                <th class="slds-p-around--x-small slds-text-align--center" style="width: 100px">Editable?</th>
                <th class="slds-p-around--x-small slds-text-align--center" style="width: 100px">Required?</th>
                <th class="slds-p-around--x-small slds-text-align--center" style="width: 100px">Hidden?</th>
                <th class="slds-p-around--x-small" style="width: 250px">Default Value</th>
                <th class="slds-p-around--x-small" style="width: 140px">Initial Width (px)</th>
                <th class="slds-p-around--x-small" style="width: 80px">Order</th>
              </tr>
            </thead>
            <tbody class="">
              <template for:each={fieldsToDisplayTable} for:item="field">
                <tr key={field.value}>
                  <td>
                    <c-od-datatable-input-generic type={fieldTypes.TEXT} field-name="apiName" value={field.value}>
                    </c-od-datatable-input-generic>
                  </td>
                  <td>
                    <c-od-datatable-input-generic
                      type={fieldTypes.TEXT}
                      field-name="tableLabel"
                      data-value={field.value}
                      editable
                      value={field.tableLabel}
                      onupdatefield={handleUpdateField}
                    >
                    </c-od-datatable-input-generic>
                  </td>
                  <td class="slds-grid slds-p-top--xx-small slds-wrap">
                    <c-od-datatable-input-generic type={fieldTypes.TEXT} field-name="type" value={field.typeSpec}>
                    </c-od-datatable-input-generic>
                    <template if:true={field.isLookup}>
                      <lightning-button
                        label="Configure"
                        title="Configure"
                        icon-name="utility:settings"
                        data-object={field.parentObjectName}
                        class="slds-m-left--small"
                        data-field={field.value}
                        data-configuration={field.lookupConfig}
                        onclick={handleOpenLookupConfiguration}
                      >
                      </lightning-button>
                    </template>
                  </td>
                  <td class="slds-p-around--xx-small slds-text-align--center">
                    <c-od-datatable-input-generic
                      type={fieldTypes.CHECKBOX}
                      field-name="isEditable"
                      data-value={field.value}
                      value={field.isEditable}
                      editable={field.canEdit}
                      onupdatefield={handleUpdateField}
                    >
                    </c-od-datatable-input-generic>
                  </td>
                  <td class="slds-p-around--xx-small slds-text-align--center">
                    <c-od-datatable-input-generic
                      type={fieldTypes.CHECKBOX}
                      field-name="required"
                      data-value={field.value}
                      value={field.required}
                      editable={field.canEdit}
                      onupdatefield={handleUpdateField}
                    >
                    </c-od-datatable-input-generic>
                  </td>
                  <td class="slds-p-around--xx-small slds-text-align--center">
                    <c-od-datatable-input-generic
                      type={fieldTypes.CHECKBOX}
                      field-name="hidden"
                      data-value={field.value}
                      value={field.hidden}
                      editable
                      onupdatefield={handleUpdateField}
                    >
                    </c-od-datatable-input-generic>
                  </td>
                  <td>
                    <c-od-datatable-input-generic
                      type={field.typeForDefault}
                      field-name="defaultValue"
                      data-value={field.value}
                      inside-popup-height={popupHeight}
                      editable
                      value={field.defaultValue}
                      onupdatefield={handleUpdateField}
                      parent-object-name={field.parentObjectName}
                      precision={field.precision}
                      is-html={field.isHTML}
                      scale={field.scale}
                      max-length={field.maxLength}
                      options={field.options}
                      opened={field.opened}
                      onfocusdropdown={handleDefaultOnFocusDropdown}
                      onblurdropdown={handleDefaultOnBlurDropdown}
                      is-multi={field.isMulti}
                    >
                    </c-od-datatable-input-generic>
                  </td>
                  <td>
                    <c-od-datatable-input-generic
                      type={fieldTypes.INTEGER}
                      field-name="initialWidth"
                      editable
                      scale="0"
                      data-value={field.value}
                      value={field.initialWidth}
                      onupdatefield={handleUpdateField}
                    >
                    </c-od-datatable-input-generic>
                  </td>
                  <td>
                    <c-od-datatable-input-generic
                      type={fieldTypes.INTEGER}
                      field-name="order"
                      editable
                      scale="0"
                      data-value={field.value}
                      value={field.order}
                      onupdatefield={handleUpdateField}
                    >
                    </c-od-datatable-input-generic>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </template>
    </div>
    <div slot="footer" class="footer-popup slds-grid">
      <div class="slds-align--absolute-center slds-size--12-of-12">
        <lightning-button
          variant="brand"
          disabled={disabledSave}
          name="save"
          label="Save"
          title="Save"
          onclick={handleSave}
          class="slds-m-right--large"
        >
        </lightning-button>
        <lightning-button name="cancel" label="Cancel" title="Cancel" onclick={handleClose}> </lightning-button>
      </div>
      <lightning-button
        name="reOrder"
        label="Reorder"
        title="Reorder"
        onclick={handleReorder}
        class="slds-is-absolute slds-m-right--x-large"
        disabled={disabledSave}
        style="right: 0"
      >
      </lightning-button>
    </div>
  </c-od-datatable-popup>

  <!-- Lookup configuration popup -->
  <template if:true={showLookupConfiguration}>
    <c-od-datatable-configuration-column-lookup
      onclose={handleCloseLookupConfiguration}
      object-name={lookupObjectName}
      class="onTopOfEverything"
      configuration={lookupConfiguration}
      data-value={lookupFieldName}
      onsave={handleSaveLookupConfiguration}
    >
    </c-od-datatable-configuration-column-lookup>
  </template>
</template>
